<div class="recovery-container">
    <div class="recovery-card fade-in">
        
        <div class="card-header">
            <h2 class="title">Cambiar Contraseña</h2>
            <p class="subtitle">Por seguridad, verifiquemos tu identidad</p>
        </div>

        <div *ngIf="errorMessage" class="alert error">{{ errorMessage }}</div>
        <div *ngIf="successMessage" class="alert success">{{ successMessage }}</div>

        <div *ngIf="isLoading && !codeForm.dirty && currentStep === 1" style="margin-bottom: 20px; color: #64748b;">
            Enviando código a tu correo...
        </div>

        <div [ngSwitch]="currentStep">

            <div *ngSwitchCase="1">
                <form [formGroup]="codeForm">
                    <div class="form-group">
                        <label>Código de Verificación</label>
                        <input type="text" 
                               formControlName="code" 
                               placeholder="----" 
                               maxlength="4" 
                               class="code-input"
                               (input)="limpiarCodigo($event)">
                    </div>
                    
                    <small *ngIf="codeForm.invalid && codeForm.touched" style="color: red; display: block; margin-bottom: 10px;">
                        El código debe tener 4 dígitos exactos.
                    </small>
                    
                    <button type="button" 
                            (click)="verifyCode()" 
                            [disabled]="isLoading" 
                            class="btn-primary">
                        {{ isLoading ? 'Verificando...' : 'Verificar Código' }}
                    </button>
                    
                    <button type="button" class="btn-link" (click)="enviarCodigo()" [disabled]="isLoading">
                        Reenviar código
                    </button>
                </form>
            </div>

            <div *ngSwitchCase="2">
                <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
                    <div class="form-group">
                        <label>Nueva Contraseña</label>
                        <input type="password" formControlName="newPassword" placeholder="Mínimo 6 caracteres">
                    </div>
                    <div class="form-group">
                        <label>Confirmar Contraseña</label>
                        <input type="password" formControlName="confirmPassword" placeholder="Repite la contraseña">
                    </div>
                    <button type="submit" [disabled]="passwordForm.invalid || isLoading" class="btn-primary">
                        Actualizar Contraseña
                    </button>
                </form>
            </div>

        </div>

        <div class="card-footer">
            <a routerLink="/settings" class="back-link">← Cancelar y volver</a>
        </div>

    </div>
</div>